# 启动脚本使用说明

本文档详细说明了多目标材料性能预测系统的各种启动脚本的使用方法。

---

## Windows 平台

### 1. 批处理脚本（推荐新手使用）

#### 启动服务：`start_all.bat`

**使用方法：**

方式 1：双击 `start_all.bat` 文件

方式 2：在命令提示符中运行
```cmd
start_all.bat
```

**功能特点：**
- ✅ 自动检查系统依赖（Python、Node.js、npm）
- ✅ 自动检查 RAG 模型文件完整性
- ✅ 自动安装后端和前端依赖
- ✅ 自动创建必要的目录结构
- ✅ 系统完整性检查
- ✅ 后台启动服务（窗口最小化）
- ✅ 日志输出到 `Logs/` 目录
- ✅ 可选择是否自动打开浏览器

**执行流程：**
1. [0/6] 初始化目录结构
2. [1/6] 检查系统依赖
3. [2/6] 检查 RAG 模型配置
4. [3/6] 检查后端依赖
5. [4/6] 检查前端依赖
6. [5/6] 系统完整性检查
7. [6/6] 启动服务

**输出信息：**
- 后端 API: http://localhost:8000
- API 文档: http://localhost:8000/docs
- 前端应用: http://localhost:3000
- 后端日志: `Logs\backend.log`
- 前端日志: `Logs\frontend.log`

#### 停止服务：`stop_all.bat`

**使用方法：**

方式 1：双击 `stop_all.bat` 文件

方式 2：在命令提示符中运行
```cmd
stop_all.bat
```

**功能特点：**
- ✅ 自动查找并终止后端进程（通过窗口标题和端口）
- ✅ 自动查找并终止前端进程（通过窗口标题和端口）
- ✅ 清理残留的 Node.js 进程
- ✅ 友好的状态提示

**查找策略：**
1. 通过窗口标题查找（"多目标预测系统-后端"/"多目标预测系统-前端"）
2. 通过端口查找（8000 端口的 python.exe，3000 端口的 node.exe）
3. 清理可能的残留进程

---

### 2. PowerShell 脚本（推荐高级用户）

#### 启动服务：`start_all.ps1`

**使用方法：**

在 PowerShell 中运行：
```powershell
.\start_all.ps1
```

**注意事项：**

如果遇到执行策略限制，请以管理员身份运行 PowerShell 并执行：
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

**功能特点：**
- ✅ 彩色输出（绿色=成功，黄色=警告，红色=错误，青色=信息）
- ✅ 更详细的错误处理
- ✅ 进程 ID 跟踪
- ✅ 更好的日志重定向（分离标准输出和错误输出）
- ✅ 所有 `start_all.bat` 的功能

**优势：**
- 更现代的脚本语言
- 更强大的错误处理
- 更好的进程管理
- 彩色输出更易读

#### 停止服务：`stop_all.ps1`

**使用方法：**

在 PowerShell 中运行：
```powershell
.\stop_all.ps1
```

**功能特点：**
- ✅ 使用 `Get-NetTCPConnection` 精确查找端口占用
- ✅ 使用 WMI 查询进程命令行参数
- ✅ 更智能的进程识别
- ✅ 彩色输出
- ✅ 更详细的状态信息

**查找策略：**
1. 通过 TCP 连接查找（8000/3000 端口）
2. 通过进程命令行参数匹配（uvicorn、next dev）
3. 清理所有相关子进程

---

## Linux/Mac 平台

### 启动服务：`start_all.sh`

**使用方法：**

```bash
# 首次使用，添加执行权限
chmod +x start_all.sh

# 启动服务
./start_all.sh
```

**功能特点：**
- ✅ 彩色终端输出
- ✅ 自动检查并安装 uv（Python 包管理器）
- ✅ 完整的系统依赖检查
- ✅ RAG 模型完整性验证
- ✅ 自动依赖安装
- ✅ 后台进程管理
- ✅ 优雅的信号处理（Ctrl+C 停止）
- ✅ 自动清理临时文件

**停止服务：**

按 `Ctrl+C` 即可优雅停止所有服务

**特殊功能：**
- 使用 `uv` 作为包管理器（更快的依赖安装）
- 自动设置离线模式环境变量
- 健康检查（使用 curl 检测 API 可用性）
- 实时日志查看提示

---

## 常见问题

### Q1: 启动脚本报错 "找不到 Python"

**解决方案：**
1. 确认已安装 Python 3.10+
2. 确认 Python 已添加到系统 PATH
3. 在命令行运行 `python --version` 验证

### Q2: 启动脚本报错 "找不到 all-MiniLM-L6-v2 模型"

**解决方案：**
1. 按照 README.md 中的说明下载模型
2. 确保模型文件夹位于项目根目录
3. 验证模型文件完整性（config.json, model.safetensors 等）

### Q3: PowerShell 脚本无法执行

**解决方案：**
```powershell
# 以管理员身份运行 PowerShell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Q4: 服务启动后无法访问

**解决方案：**
1. 检查日志文件：`Logs\backend.log` 和 `Logs\frontend.log`
2. 确认端口 8000 和 3000 未被占用
3. 检查防火墙设置
4. 等待服务完全启动（约 10-15 秒）

### Q5: 停止脚本无法终止进程

**解决方案：**
1. 使用任务管理器手动结束 `python.exe` 和 `node.exe` 进程
2. 或使用命令行：
   ```cmd
   taskkill /F /IM python.exe
   taskkill /F /IM node.exe
   ```

### Q6: 依赖安装失败

**解决方案：**
1. 检查网络连接
2. 尝试使用国内镜像源：
   ```bash
   # Python
   pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
   
   # Node.js
   npm config set registry https://registry.npmmirror.com
   ```

---

## 脚本对比

| 特性 | start_all.bat | start_all.ps1 | start_all.sh |
|------|---------------|---------------|--------------|
| 平台 | Windows | Windows | Linux/Mac |
| 彩色输出 | ❌ | ✅ | ✅ |
| 进程跟踪 | 基础 | 高级 | 高级 |
| 错误处理 | 基础 | 详细 | 详细 |
| 易用性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 功能完整性 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 推荐用户 | 新手 | 高级用户 | Linux/Mac 用户 |

---

## 手动启动（备用方案）

如果自动启动脚本遇到问题，可以手动启动：

### 后端

```bash
cd backend
python -m uvicorn main:app --reload --port 8000
```

### 前端（新开终端）

```bash
cd frontend
npm run dev
```

---

**文档版本**: 1.0  
**最后更新**: 2025-12-06  
**维护者**: 项目开发团队

