# 启动脚本使用说明

## 快速开始

### Linux/Mac/WSL 环境

```bash
# 启动所有服务
./start_all.sh

# 停止所有服务
./stop_all.sh
```

### Windows 环境

```powershell
# PowerShell
.\start_all.ps1

# 或使用批处理
.\start_all.bat
```

## 脚本功能

### start_all.sh 功能

1. **自动检查和清理**
   - 检查并停止旧的后端/前端进程
   - 检查端口 8000 和 3000 是否被占用
   - 自动释放被占用的端口

2. **日志管理**
   - 自动备份旧日志文件（.old 后缀）
   - 创建新的日志文件
   - 避免日志文件锁定问题

3. **服务启动**
   - 启动后端服务（端口 8000）
   - 启动前端服务（端口 3000）
   - 实时显示启动状态

4. **健康检查**
   - 检查后端 API 是否响应
   - 检查前端服务是否正常

### stop_all.sh 功能

1. **优雅停止**
   - 通过 PID 文件停止服务
   - 等待进程正常退出

2. **强制停止**
   - 如果进程无法正常退出，使用 kill -9 强制停止

3. **端口清理**
   - 检查并释放 8000 和 3000 端口
   - 清理 PID 文件

## 常见问题

### 1. 日志文件被占用

**错误信息：**
```
./start_all.sh: line 301: /path/to/Logs/backend.log: Device or resource busy
```

**解决方案：**
```bash
# 方法1：使用停止脚本
./stop_all.sh

# 方法2：手动停止进程
lsof -i :8000  # 查找后端进程
lsof -i :3000  # 查找前端进程
kill <PID>     # 停止进程

# 方法3：关闭占用日志文件的程序
# 检查是否有编辑器或日志查看器打开了日志文件
```

### 2. 端口被占用

**错误信息：**
```
⚠ 端口 8000 已被占用 (后端)
```

**解决方案：**
脚本会自动尝试停止占用进程。如果失败，手动执行：
```bash
# 查找占用端口的进程
lsof -i :8000

# 停止进程
kill <PID>

# 或强制停止
kill -9 <PID>
```

### 3. 权限问题

**错误信息：**
```
Permission denied
```

**解决方案：**
```bash
# 添加执行权限
chmod +x start_all.sh stop_all.sh

# 确保日志目录可写
chmod -R 755 Logs storage
```

### 4. lsof 命令不可用（Windows Git Bash）

**解决方案：**
使用 Windows 版本的启动脚本：
```powershell
# PowerShell
.\start_all.ps1

# 或批处理
.\start_all.bat
```

## 日志查看

### 实时查看日志

```bash
# 后端日志
tail -f Logs/backend.log

# 前端日志
tail -f Logs/frontend.log
```

### 查看历史日志

```bash
# 当前日志
cat Logs/backend.log

# 旧日志（备份）
cat Logs/backend.log.old
```

## 服务访问

启动成功后，可以访问：

- **前端应用**: http://localhost:3000
- **后端 API**: http://localhost:8000
- **API 文档**: http://localhost:8000/docs

## 目录结构

```
MuItiObject/
├── start_all.sh          # Linux/Mac 启动脚本
├── stop_all.sh           # Linux/Mac 停止脚本
├── start_all.ps1         # Windows PowerShell 启动脚本
├── start_all.bat         # Windows 批处理启动脚本
├── Logs/                 # 日志目录
│   ├── backend.log       # 后端日志
│   ├── backend.log.old   # 后端旧日志（备份）
│   ├── frontend.log      # 前端日志
│   └── frontend.log.old  # 前端旧日志（备份）
├── .temp/                # 临时文件目录
│   ├── backend.pid       # 后端进程 PID
│   └── frontend.pid      # 前端进程 PID
└── storage/              # 存储目录
    ├── uploads/          # 上传文件
    ├── results/          # 预测结果
    └── tasks/            # 任务数据
```

## 注意事项

1. **首次运行**：首次运行可能需要较长时间安装依赖
2. **网络要求**：前端依赖安装需要网络连接
3. **Python 环境**：后端需要 Python 3.8+ 和 uv 包管理器
4. **Node.js 环境**：前端需要 Node.js 16+ 和 npm
5. **端口占用**：确保 8000 和 3000 端口未被其他程序占用

