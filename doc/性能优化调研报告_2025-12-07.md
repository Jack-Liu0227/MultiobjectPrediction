# å¤šç›®æ ‡ä¼˜åŒ–é¢„æµ‹ç³»ç»Ÿ - æ€§èƒ½ä¼˜åŒ–è°ƒç ”æŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ**: 2025-12-07  
**ç³»ç»Ÿç‰ˆæœ¬**: 1.0.0  
**è°ƒç ”èŒƒå›´**: å‰åç«¯äº¤äº’æ€§èƒ½ã€å†…å­˜ä½¿ç”¨ã€ç½‘é¡µå»¶è¿Ÿã€ç”¨æˆ·ä½“éªŒ

---

## ä¸€ã€å½“å‰æ¶æ„æ¦‚è¿°

### 1.1 æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Next.js 14 + React 18 + TypeScript + Tailwind CSS
- **åç«¯**: FastAPI + Uvicorn + SQLAlchemy + SQLite
- **æ•°æ®å¤„ç†**: Pandas + NumPy + Sentence-Transformers
- **é€šä¿¡æ–¹å¼**: RESTful API (HTTP/JSON)
- **éƒ¨ç½²æ¨¡å¼**: å‰åç«¯åˆ†ç¦»,æœ¬åœ°å¼€å‘ç¯å¢ƒ

### 1.2 æ ¸å¿ƒäº¤äº’æµç¨‹
1. **æ–‡ä»¶ä¸Šä¼ **: å‰ç«¯ â†’ åç«¯ (multipart/form-data)
2. **ä»»åŠ¡æäº¤**: å‰ç«¯ â†’ åç«¯ (JSON)
3. **çŠ¶æ€è½®è¯¢**: å‰ç«¯å®šæ—¶è¯·æ±‚ â†’ åç«¯ (3ç§’é—´éš”)
4. **ç»“æœè·å–**: å‰ç«¯å¹¶è¡Œè¯·æ±‚ â†’ åç«¯ (Promise.all)
5. **æ•°æ®å±•ç¤º**: åŠ¨æ€å¯¼å…¥å›¾è¡¨ç»„ä»¶ (ä»£ç åˆ†å‰²)

### 1.3 æ•°æ®æµç‰¹å¾
- **ä¸Šä¼ æ–‡ä»¶**: æœ€å¤§ 50MB CSV
- **å¹¶å‘é¢„æµ‹**: é»˜è®¤ 5 ä¸ªå·¥ä½œçº¿ç¨‹
- **æ•°æ®åº“**: SQLite (å•æ–‡ä»¶,æ— è¿æ¥æ± )
- **ç¼“å­˜ç­–ç•¥**: å†…å­˜ç¼“å­˜ (å‘é‡åµŒå…¥)

---

## äºŒã€æ€§èƒ½é—®é¢˜æ¸…å• (æŒ‰ä¼˜å…ˆçº§æ’åº)

### ğŸ”´ P0 - ä¸¥é‡é—®é¢˜ (ç«‹å³ä¿®å¤)

#### 1. æ•°æ®åº“è¿æ¥æœªæ­£ç¡®å…³é—­ - å†…å­˜æ³„æ¼é£é™©
**ä½ç½®**: `backend/database/models.py:168-174`, `backend/database/task_db.py`, `backend/database/dataset_db.py`

**é—®é¢˜æè¿°**:
- æ‰€æœ‰æ•°æ®åº“æ“ä½œä½¿ç”¨ `SessionLocal()` åˆ›å»ºä¼šè¯,ä½†åœ¨å¼‚å¸¸æƒ…å†µä¸‹å¯èƒ½æœªæ­£ç¡®å…³é—­
- `finally` å—ä¸­è°ƒç”¨ `db.close()`,ä½†åœ¨é•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡ä¸­å¯èƒ½ç´¯ç§¯æœªé‡Šæ”¾çš„è¿æ¥
- SQLite é»˜è®¤é…ç½® `check_same_thread=False` å¯èƒ½å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜

**å½±å“**:
- å†…å­˜å ç”¨æŒç»­å¢é•¿
- æ•°æ®åº“é”å®šé—®é¢˜
- å¹¶å‘æ€§èƒ½ä¸‹é™

**ä»£ç ç¤ºä¾‹**:
```python
# backend/database/task_db.py:36-66
def create_task(self, task_data: Dict[str, Any]) -> str:
    db = SessionLocal()
    try:
        # ... æ•°æ®åº“æ“ä½œ ...
        db.commit()
        return task.task_id
    except Exception as e:
        db.rollback()  # å¼‚å¸¸æ—¶å›æ»š
        raise
    finally:
        db.close()  # âš ï¸ å¯èƒ½åœ¨æŸäº›å¼‚å¸¸æƒ…å†µä¸‹æœªæ‰§è¡Œ
```

**ä¼˜åŒ–å»ºè®®**:
```python
# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç¡®ä¿èµ„æºé‡Šæ”¾
from contextlib import contextmanager

@contextmanager
def get_db_session():
    db = SessionLocal()
    try:
        yield db
        db.commit()
    except Exception:
        db.rollback()
        raise
    finally:
        db.close()

# ä½¿ç”¨æ–¹å¼
def create_task(self, task_data: Dict[str, Any]) -> str:
    with get_db_session() as db:
        # ... æ•°æ®åº“æ“ä½œ ...
```

**é¢„æœŸæ•ˆæœ**: æ¶ˆé™¤å†…å­˜æ³„æ¼,æå‡é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§

---

#### 2. å‰ç«¯è½®è¯¢å®šæ—¶å™¨æœªæ¸…ç† - å†…å­˜æ³„æ¼
**ä½ç½®**: `frontend/pages/results/[id].tsx:84-96`, `frontend/components/TaskSidebar.tsx:78-86`

**é—®é¢˜æè¿°**:
- ç»“æœé¡µé¢ä½¿ç”¨ `setInterval` æ¯ 3 ç§’è½®è¯¢ä»»åŠ¡çŠ¶æ€
- ç»„ä»¶å¸è½½æ—¶é€šè¿‡ `useEffect` è¿”å›å‡½æ•°æ¸…ç†,ä½†åœ¨å¿«é€Ÿåˆ‡æ¢é¡µé¢æ—¶å¯èƒ½é—æ¼
- ä»»åŠ¡ä¾§è¾¹æ æ ¹æ®ä»»åŠ¡çŠ¶æ€åŠ¨æ€è°ƒæ•´è½®è¯¢é—´éš” (5ç§’/10ç§’),ä½†æœªè€ƒè™‘ç»„ä»¶é‡æ¸²æŸ“å¯¼è‡´çš„å®šæ—¶å™¨é‡å¤åˆ›å»º

**å½±å“**:
- å¤šä¸ªå®šæ—¶å™¨åŒæ—¶è¿è¡Œ,æ¶ˆè€— CPU å’Œç½‘ç»œèµ„æº
- å†…å­˜å ç”¨å¢åŠ 
- ä¸å¿…è¦çš„ API è¯·æ±‚

**ä»£ç ç¤ºä¾‹**:
```typescript
// frontend/pages/results/[id].tsx:84-96
useEffect(() => {
  if (id) {
    checkTaskStatusAndLoadResults(id as string);
    loadTaskConfig();
  }
  
  // æ¸…ç†è½®è¯¢
  return () => {
    if (pollingIntervalRef.current) {
      clearInterval(pollingIntervalRef.current);  // âœ… å·²æœ‰æ¸…ç†
    }
  };
}, [id]);

// âš ï¸ é—®é¢˜: startPolling å‡½æ•°å†…éƒ¨åˆ›å»ºæ–°å®šæ—¶å™¨å‰æœªæ¸…ç†æ—§å®šæ—¶å™¨
const startPolling = (resultId: string) => {
  setIsPolling(true);
  
  if (pollingIntervalRef.current) {
    clearInterval(pollingIntervalRef.current);  // âœ… å·²æœ‰æ¸…ç†
  }
  
  pollingIntervalRef.current = setInterval(async () => {
    // ... è½®è¯¢é€»è¾‘ ...
  }, 3000);
};
```

**ä¼˜åŒ–å»ºè®®**:
```typescript
// 1. ä½¿ç”¨ useRef ç¡®ä¿å®šæ—¶å™¨å¼•ç”¨ç¨³å®š
const pollingIntervalRef = useRef<NodeJS.Timeout | null>(null);

// 2. å°è£…æ¸…ç†å‡½æ•°
const stopPolling = useCallback(() => {
  if (pollingIntervalRef.current) {
    clearInterval(pollingIntervalRef.current);
    pollingIntervalRef.current = null;
  }
  setIsPolling(false);
}, []);

// 3. åœ¨æ‰€æœ‰å¯èƒ½çš„é€€å‡ºç‚¹è°ƒç”¨æ¸…ç†
useEffect(() => {
  return () => {
    stopPolling();
  };
}, [stopPolling]);
```

**é¢„æœŸæ•ˆæœ**: æ¶ˆé™¤å®šæ—¶å™¨æ³„æ¼,å‡å°‘ 50% ä¸å¿…è¦çš„ API è¯·æ±‚

---

#### 3. äº‹ä»¶ç›‘å¬å™¨æœªæ¸…ç† - å†…å­˜æ³„æ¼
**ä½ç½®**: `frontend/pages/results/[id].tsx:99-110`, `frontend/pages/tasks.tsx:350-365`, `frontend/pages/task-comparison.tsx:125-141`

**é—®é¢˜æè¿°**:
- å¤šä¸ªç»„ä»¶ç›‘å¬ `taskEvents` è‡ªå®šä¹‰äº‹ä»¶å’Œ DOM äº‹ä»¶ (`mousedown`)
- ä½¿ç”¨ `useEffect` è¿”å›å‡½æ•°æ¸…ç†,ä½†ä¾èµ–æ•°ç»„å¯èƒ½å¯¼è‡´é‡å¤æ³¨å†Œ
- `localStorage` çš„ `storage` äº‹ä»¶ç›‘å¬å™¨æœªåœ¨æ‰€æœ‰ç»„ä»¶ä¸­æ­£ç¡®æ¸…ç†

**å½±å“**:
- äº‹ä»¶ç›‘å¬å™¨ç´¯ç§¯,å¯¼è‡´å†…å­˜æ³„æ¼
- åŒä¸€äº‹ä»¶è§¦å‘å¤šæ¬¡å›è°ƒ,æ€§èƒ½ä¸‹é™
- è·¨æ ‡ç­¾é¡µåŒæ­¥æ—¶å¯èƒ½å‡ºç°ç«æ€æ¡ä»¶

**ä»£ç ç¤ºä¾‹**:
```typescript
// frontend/pages/results/[id].tsx:99-110
useEffect(() => {
  loadCompletedTasks();

  const handleClickOutside = (event: MouseEvent) => {
    if (taskSelectorRef.current && !taskSelectorRef.current.contains(event.target as Node)) {
      setShowTaskSelector(false);
    }
  };
  document.addEventListener('mousedown', handleClickOutside);
  return () => document.removeEventListener('mousedown', handleClickOutside);  // âœ… å·²æ¸…ç†
}, []);  // âš ï¸ ç©ºä¾èµ–æ•°ç»„,ä½† loadCompletedTasks å¯èƒ½å¼•ç”¨å¤–éƒ¨çŠ¶æ€

// frontend/pages/tasks.tsx:350-365
useEffect(() => {
  const handleNoteUpdate = (data: { taskId: string; field?: string; value?: any }) => {
    setTasks(prevTasks => prevTasks.map(t =>
      t.task_id === data.taskId ? { ...t, note: data.value } : t
    ));

    if (selectedTask?.task_id === data.taskId) {
      setSelectedTask(prev => prev ? { ...prev, note: data.value } : null);
    }
  };

  taskEvents.on('note-updated', handleNoteUpdate);

  return () => {
    taskEvents.off('note-updated', handleNoteUpdate);  // âœ… å·²æ¸…ç†
  };
}, [selectedTask]);  // âš ï¸ selectedTask å˜åŒ–æ—¶é‡æ–°æ³¨å†Œ,å¯èƒ½å¯¼è‡´é‡å¤ç›‘å¬
```

**ä¼˜åŒ–å»ºè®®**:
```typescript
// 1. ä½¿ç”¨ useCallback ç¨³å®šå›è°ƒå‡½æ•°å¼•ç”¨
const handleNoteUpdate = useCallback((data: { taskId: string; field?: string; value?: any }) => {
  setTasks(prevTasks => prevTasks.map(t =>
    t.task_id === data.taskId ? { ...t, note: data.value } : t
  ));

  setSelectedTask(prev =>
    prev?.task_id === data.taskId ? { ...prev, note: data.value } : prev
  );
}, []);  // ç©ºä¾èµ–,ä½¿ç”¨ prev æ¨¡å¼æ›´æ–°çŠ¶æ€

// 2. ç¡®ä¿äº‹ä»¶ç›‘å¬å™¨åªæ³¨å†Œä¸€æ¬¡
useEffect(() => {
  taskEvents.on('note-updated', handleNoteUpdate);
  return () => {
    taskEvents.off('note-updated', handleNoteUpdate);
  };
}, [handleNoteUpdate]);  // ä¾èµ–ç¨³å®šçš„å›è°ƒ
```

**é¢„æœŸæ•ˆæœ**: æ¶ˆé™¤äº‹ä»¶ç›‘å¬å™¨æ³„æ¼,å‡å°‘å†…å­˜å ç”¨ 20-30%

---

### ğŸŸ  P1 - é«˜ä¼˜å…ˆçº§ (æœ¬å‘¨ä¿®å¤)

#### 4. å¤§æ–‡ä»¶ä¸Šä¼ å†…å­˜å ç”¨è¿‡é«˜
**ä½ç½®**: `backend/api/upload.py:40-44`, `backend/routers/datasets.py:74-76`

**é—®é¢˜æè¿°**:
- æ–‡ä»¶ä¸Šä¼ æ—¶ä½¿ç”¨ `await file.read()` ä¸€æ¬¡æ€§è¯»å–å…¨éƒ¨å†…å®¹åˆ°å†…å­˜
- æœ€å¤§æ–‡ä»¶ 50MB,åœ¨å¹¶å‘ä¸Šä¼ æ—¶å¯èƒ½å ç”¨æ•°ç™¾ MB å†…å­˜
- æœªä½¿ç”¨æµå¼å¤„ç†,æ— æ³•å¤„ç†è¶…å¤§æ–‡ä»¶

**å½±å“**:
- å†…å­˜å³°å€¼è¿‡é«˜
- å¹¶å‘ä¸Šä¼ æ—¶å¯èƒ½å¯¼è‡´ OOM
- ä¸Šä¼ å¤§æ–‡ä»¶æ—¶å“åº”æ—¶é—´é•¿

**ä»£ç ç¤ºä¾‹**:
```python
# backend/api/upload.py:40-44
@router.post("/file", response_model=UploadResponse)
async def upload_file(file: UploadFile = File(...)):
    try:
        if not file.filename.endswith('.csv'):
            raise HTTPException(status_code=400, detail="åªæ”¯æŒCSVæ–‡ä»¶")

        # âš ï¸ ä¸€æ¬¡æ€§è¯»å–å…¨éƒ¨å†…å®¹åˆ°å†…å­˜
        content = await file.read()

        # ä¿å­˜æ–‡ä»¶
        file_id, file_path = file_handler.save_uploaded_file(content, file.filename)
```

**ä¼˜åŒ–å»ºè®®**:
```python
# ä½¿ç”¨æµå¼å¤„ç†
import aiofiles

@router.post("/file", response_model=UploadResponse)
async def upload_file(file: UploadFile = File(...)):
    try:
        if not file.filename.endswith('.csv'):
            raise HTTPException(status_code=400, detail="åªæ”¯æŒCSVæ–‡ä»¶")

        # ç”Ÿæˆæ–‡ä»¶è·¯å¾„
        file_id = str(uuid.uuid4())
        file_path = UPLOAD_DIR / f"{file_id}_{file.filename}"

        # æµå¼å†™å…¥æ–‡ä»¶ (æ¯æ¬¡ 1MB)
        async with aiofiles.open(file_path, 'wb') as f:
            while chunk := await file.read(1024 * 1024):  # 1MB chunks
                await f.write(chunk)

        # è¯»å–æ–‡ä»¶ä¿¡æ¯
        file_info = file_handler.get_file_info(file_path)

        return UploadResponse(...)
```

**é¢„æœŸæ•ˆæœ**: å†…å­˜å ç”¨é™ä½ 80%,æ”¯æŒæ›´å¤§æ–‡ä»¶ä¸Šä¼ 

---

#### 5. API å“åº”ä½“è¿‡å¤§ - ç½‘ç»œä¼ è¾“æ…¢
**ä½ç½®**: `backend/api/results.py:22-106`, `frontend/pages/results/[id].tsx:187-192`

**é—®é¢˜æè¿°**:
- `/api/results/{result_id}` è¿”å›å®Œæ•´é¢„æµ‹ç»“æœ,åŒ…å«æ‰€æœ‰æ ·æœ¬æ•°æ®
- å¤§æ•°æ®é›† (1000+ æ ·æœ¬) æ—¶å“åº”ä½“å¯è¾¾æ•° MB
- å‰ç«¯ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ•°æ®,å¯¼è‡´é¡µé¢å¡é¡¿
- æœªå®ç°åˆ†é¡µæˆ–è™šæ‹Ÿæ»šåŠ¨

**å½±å“**:
- é¦–æ¬¡åŠ è½½æ—¶é—´é•¿ (5-10ç§’)
- ç½‘ç»œä¼ è¾“æ…¢
- å‰ç«¯æ¸²æŸ“å¡é¡¿

**ä»£ç ç¤ºä¾‹**:
```python
# backend/api/results.py:94-100
return ResultsResponse(
    result_id=result_id,
    task_id=task_id,
    predictions=predictions,  # âš ï¸ è¿”å›å…¨éƒ¨æ•°æ® (å¯èƒ½æ•°åƒæ¡)
    metrics=metrics,
    execution_time=execution_time
)
```

**ä¼˜åŒ–å»ºè®®**:
```python
# 1. æ·»åŠ åˆ†é¡µå‚æ•°
@router.get("/{result_id}", response_model=ResultsResponse)
async def get_results(
    result_id: str,
    page: int = 1,
    page_size: int = 50,
    include_predictions: bool = True
):
    # åªè¿”å›è¯·æ±‚çš„é¡µé¢æ•°æ®
    if include_predictions:
        start_idx = (page - 1) * page_size
        end_idx = start_idx + page_size
        predictions = predictions[start_idx:end_idx]
    else:
        predictions = []  # åªè¿”å›å…ƒæ•°æ®

    return ResultsResponse(
        result_id=result_id,
        task_id=task_id,
        predictions=predictions,
        total_count=len(all_predictions),
        page=page,
        page_size=page_size,
        metrics=metrics,
        execution_time=execution_time
    )

# 2. å‰ç«¯å®ç°è™šæ‹Ÿæ»šåŠ¨
// ä½¿ç”¨ react-window æˆ– react-virtualized
import { FixedSizeList } from 'react-window';

<FixedSizeList
  height={600}
  itemCount={total}
  itemSize={50}
  onItemsRendered={({ visibleStartIndex, visibleStopIndex }) => {
    // åŠ¨æ€åŠ è½½å¯è§èŒƒå›´çš„æ•°æ®
    loadPageData(Math.floor(visibleStartIndex / pageSize) + 1);
  }}
>
  {Row}
</FixedSizeList>
```

**é¢„æœŸæ•ˆæœ**: é¦–æ¬¡åŠ è½½æ—¶é—´å‡å°‘ 70%,å†…å­˜å ç”¨é™ä½ 60%

---

#### 6. å¹¶å‘è¯·æ±‚æœªæ§åˆ¶ - æœåŠ¡å™¨å‹åŠ›å¤§
**ä½ç½®**: `frontend/pages/results/[id].tsx:187-192`, `frontend/pages/prediction.tsx:125-133`

**é—®é¢˜æè¿°**:
- ä½¿ç”¨ `Promise.all` å¹¶è¡Œå‘èµ·å¤šä¸ªè¯·æ±‚,æ— å¹¶å‘é™åˆ¶
- ç»“æœé¡µé¢åŒæ—¶è¯·æ±‚ `process_details.json`ã€`results`ã€`pareto` ä¸‰ä¸ªæ¥å£
- æ•°æ®é›†åˆ—è¡¨é¡µé¢ä¸€æ¬¡æ€§åŠ è½½ 100 ä¸ªæ•°æ®é›†ä¿¡æ¯

**å½±å“**:
- æœåŠ¡å™¨ç¬æ—¶å‹åŠ›å¤§
- æµè§ˆå™¨å¹¶å‘è¿æ¥æ•°é™åˆ¶ (6-8ä¸ª)
- å¯èƒ½è§¦å‘ API é™æµ

**ä»£ç ç¤ºä¾‹**:
```typescript
// frontend/pages/results/[id].tsx:187-192
const [processDetailsResponse, resultsData, paretoData] = await Promise.all([
  fetch(`http://localhost:8000/api/results/${resultId}/process_details.json`),
  getResults(resultId),
  getParetoAnalysis(resultId).catch(() => null),
]);  // âš ï¸ æ— å¹¶å‘æ§åˆ¶
```

**ä¼˜åŒ–å»ºè®®**:
```typescript
// 1. å®ç°å¹¶å‘æ§åˆ¶
class ConcurrencyController {
  private queue: Array<() => Promise<any>> = [];
  private running = 0;

  constructor(private maxConcurrency: number = 3) {}

  async run<T>(fn: () => Promise<T>): Promise<T> {
    while (this.running >= this.maxConcurrency) {
      await new Promise(resolve => setTimeout(resolve, 100));
    }

    this.running++;
    try {
      return await fn();
    } finally {
      this.running--;
    }
  }
}

const controller = new ConcurrencyController(3);

// 2. ä½¿ç”¨å¹¶å‘æ§åˆ¶
const [processDetailsResponse, resultsData, paretoData] = await Promise.all([
  controller.run(() => fetch(`http://localhost:8000/api/results/${resultId}/process_details.json`)),
  controller.run(() => getResults(resultId)),
  controller.run(() => getParetoAnalysis(resultId).catch(() => null)),
]);

// 3. ä¼˜å…ˆçº§åŠ è½½
const resultsData = await getResults(resultId);  // ä¼˜å…ˆåŠ è½½æ ¸å¿ƒæ•°æ®
const [processDetailsResponse, paretoData] = await Promise.all([
  fetch(`http://localhost:8000/api/results/${resultId}/process_details.json`),
  getParetoAnalysis(resultId).catch(() => null),
]);  // æ¬¡è¦æ•°æ®å¹¶è¡ŒåŠ è½½
```

**é¢„æœŸæ•ˆæœ**: æœåŠ¡å™¨è´Ÿè½½é™ä½ 40%,é¿å… API é™æµ

---

### ğŸŸ¡ P2 - ä¸­ä¼˜å…ˆçº§ (æœ¬æœˆä¿®å¤)

#### 7. localStorage é¢‘ç¹è¯»å†™ - æ€§èƒ½å¼€é”€
**ä½ç½®**: `frontend/pages/task-comparison.tsx:71-155`

**é—®é¢˜æè¿°**:
- ä»»åŠ¡å¯¹æ¯”é¡µé¢åœ¨å¤šä¸ª `useEffect` ä¸­é¢‘ç¹è¯»å†™ `localStorage`
- æ¯æ¬¡çŠ¶æ€å˜åŒ–éƒ½è§¦å‘ `localStorage.setItem`,å¯èƒ½æ¯ç§’æ•°åæ¬¡
- æœªä½¿ç”¨é˜²æŠ–æˆ–èŠ‚æµ,å½±å“æ€§èƒ½

**å½±å“**:
- ä¸»çº¿ç¨‹é˜»å¡
- é¡µé¢å“åº”å˜æ…¢
- æµè§ˆå™¨å­˜å‚¨ I/O å¼€é”€

**ä»£ç ç¤ºä¾‹**:
```typescript
// frontend/pages/task-comparison.tsx:143-148
useEffect(() => {
  if (typeof window !== 'undefined') {
    localStorage.setItem('taskComparisonSidebarOpen', JSON.stringify(sidebarOpen));
  }
}, [sidebarOpen]);  // âš ï¸ æ¯æ¬¡çŠ¶æ€å˜åŒ–éƒ½å†™å…¥

useEffect(() => {
  if (typeof window !== 'undefined') {
    localStorage.setItem('taskComparisonCustomNames', JSON.stringify(customTaskNames));
  }
}, [customTaskNames]);  // âš ï¸ å¯¹è±¡å˜åŒ–é¢‘ç¹
```

**ä¼˜åŒ–å»ºè®®**:
```typescript
// 1. ä½¿ç”¨é˜²æŠ–
import { useCallback, useEffect, useRef, useMemo } from 'react';

function useDebouncedLocalStorage(key: string, value: any, delay: number = 500) {
  const timeoutRef = useRef<NodeJS.Timeout>();

  useEffect(() => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }

    timeoutRef.current = setTimeout(() => {
      localStorage.setItem(key, JSON.stringify(value));
    }, delay);

    return () => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }
    };
  }, [key, value, delay]);
}

// 2. ä½¿ç”¨æ–¹å¼
useDebouncedLocalStorage('taskComparisonSidebarOpen', sidebarOpen);
useDebouncedLocalStorage('taskComparisonCustomNames', customTaskNames);

// 3. æ‰¹é‡æ›´æ–°
const saveAllSettings = useCallback(() => {
  const settings = {
    sidebarOpen,
    customTaskNames,
    taskTableCollapsed,
    taskDisplayMode,
  };
  localStorage.setItem('taskComparisonSettings', JSON.stringify(settings));
}, [sidebarOpen, customTaskNames, taskTableCollapsed, taskDisplayMode]);

// ä½¿ç”¨é˜²æŠ–çš„æ‰¹é‡ä¿å­˜ (éœ€è¦å®‰è£… lodash æˆ–è‡ªå®šä¹‰ debounce å‡½æ•°)
import debounce from 'lodash/debounce';

const debouncedSave = useMemo(
  () => debounce(saveAllSettings, 500),
  [saveAllSettings]
);

useEffect(() => {
  debouncedSave();
}, [sidebarOpen, customTaskNames, taskTableCollapsed, taskDisplayMode]);
```

**é¢„æœŸæ•ˆæœ**: localStorage å†™å…¥æ¬¡æ•°å‡å°‘ 90%,é¡µé¢å“åº”é€Ÿåº¦æå‡ 15%

---

#### 8. å›¾è¡¨ç»„ä»¶é‡å¤æ¸²æŸ“ - CPU å ç”¨é«˜
**ä½ç½®**: `frontend/pages/results/[id].tsx:32-58`, `frontend/components/charts/*`

**é—®é¢˜æè¿°**:
- å›¾è¡¨ç»„ä»¶ä½¿ç”¨åŠ¨æ€å¯¼å…¥,ä½†æœªä½¿ç”¨ `React.memo` ä¼˜åŒ–
- çˆ¶ç»„ä»¶çŠ¶æ€å˜åŒ–æ—¶,æ‰€æœ‰å›¾è¡¨é‡æ–°æ¸²æŸ“
- Recharts åº“æ¸²æŸ“å¼€é”€å¤§,å°¤å…¶æ˜¯å¤§æ•°æ®é›†

**å½±å“**:
- CPU å ç”¨é«˜
- é¡µé¢å¡é¡¿
- ç”µæ± æ¶ˆè€—å¿« (ç§»åŠ¨è®¾å¤‡)

**ä»£ç ç¤ºä¾‹**:
```typescript
// frontend/pages/results/[id].tsx:32-47
const ParetoFrontChart = dynamic(
  () => import('@/components/charts/ParetoFrontChart'),
  { ssr: false, loading: () => <ChartLoading height="h-96" /> }
);  // âš ï¸ æœªä½¿ç”¨ memo

// å›¾è¡¨ç»„ä»¶å†…éƒ¨
export default function ParetoFrontChart({ data, targetColumns }: Props) {
  // âš ï¸ æ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°éƒ½é‡æ–°æ¸²æŸ“
  return (
    <ResponsiveContainer width="100%" height={400}>
      <ScatterChart data={data}>
        {/* ... */}
      </ScatterChart>
    </ResponsiveContainer>
  );
}
```

**ä¼˜åŒ–å»ºè®®**:
```typescript
// 1. ä½¿ç”¨ React.memo
import React, { memo } from 'react';

const ParetoFrontChart = memo(function ParetoFrontChart({ data, targetColumns }: Props) {
  return (
    <ResponsiveContainer width="100%" height={400}>
      <ScatterChart data={data}>
        {/* ... */}
      </ScatterChart>
    </ResponsiveContainer>
  );
}, (prevProps, nextProps) => {
  // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
  return (
    prevProps.data === nextProps.data &&
    JSON.stringify(prevProps.targetColumns) === JSON.stringify(nextProps.targetColumns)
  );
});

// 2. ä½¿ç”¨ useMemo ç¼“å­˜å›¾è¡¨æ•°æ®
const chartData = useMemo(() => {
  return results.predictions.map(row => ({
    x: row[targetColumns[0]],
    y: row[targetColumns[1]],
    // ...
  }));
}, [results.predictions, targetColumns]);

// 3. æ•°æ®é‡‡æ · (å¤§æ•°æ®é›†)
const sampledData = useMemo(() => {
  if (chartData.length > 1000) {
    // æ¯éš” N ä¸ªç‚¹å–ä¸€ä¸ª
    const step = Math.ceil(chartData.length / 1000);
    return chartData.filter((_, i) => i % step === 0);
  }
  return chartData;
}, [chartData]);
```

**é¢„æœŸæ•ˆæœ**: å›¾è¡¨æ¸²æŸ“æ¬¡æ•°å‡å°‘ 80%,CPU å ç”¨é™ä½ 50%

---

#### 9. æ•°æ®åº“æŸ¥è¯¢å¯è¿›ä¸€æ­¥ä¼˜åŒ– - å¤åˆç´¢å¼•ç¼ºå¤±
**ä½ç½®**: `backend/database/models.py:71-104`, `backend/database/task_db.py:265-294`

**é—®é¢˜æè¿°**:
- ä»»åŠ¡åˆ—è¡¨æŸ¥è¯¢æŒ‰ `created_at` æ’åº,å·²æœ‰å•åˆ—ç´¢å¼•
- çŠ¶æ€ç­›é€‰ (`status`) å·²æœ‰å•åˆ—ç´¢å¼•
- ä½†ç¼ºå°‘å¸¸ç”¨æŸ¥è¯¢ç»„åˆçš„å¤åˆç´¢å¼• (status + created_at)
- å¤§é‡ä»»åŠ¡æ—¶å¤æ‚æŸ¥è¯¢æ€§èƒ½å¯è¿›ä¸€æ­¥æå‡

**å½±å“**:
- ä»»åŠ¡åˆ—è¡¨åŠ è½½åœ¨å¤§æ•°æ®é‡æ—¶å¯ä¼˜åŒ–
- æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡æœ‰æå‡ç©ºé—´
- ç”¨æˆ·ä½“éªŒå¯è¿›ä¸€æ­¥æ”¹å–„

**ä»£ç ç¤ºä¾‹**:
```python
# backend/database/models.py:76-104
status = Column(String(20), nullable=False, index=True)  # âœ… å·²æœ‰ç´¢å¼•
progress = Column(Float, default=0.0)
message = Column(Text, nullable=True)

# ...

created_at = Column(DateTime, default=datetime.now, nullable=False, index=True)  # âœ… å·²æœ‰ç´¢å¼•
started_at = Column(DateTime, nullable=True)
completed_at = Column(DateTime, nullable=True)
updated_at = Column(DateTime, default=datetime.now, onupdate=datetime.now, nullable=False)

# âš ï¸ ç¼ºå°‘å¤åˆç´¢å¼•ä¼˜åŒ–å¸¸è§æŸ¥è¯¢ç»„åˆ
```

**ä¼˜åŒ–å»ºè®®**:
```python
# 1. æ·»åŠ å¤åˆç´¢å¼•ä¼˜åŒ–å¸¸è§æŸ¥è¯¢ç»„åˆ
from sqlalchemy import Index

class Task(Base):
    __tablename__ = "tasks"

    task_id = Column(String(36), primary_key=True, index=True)
    status = Column(String(20), nullable=False, default="pending", index=True)  # âœ… å·²æœ‰ç´¢å¼•
    created_at = Column(DateTime, default=datetime.now, nullable=False, index=True)  # âœ… å·²æœ‰ç´¢å¼•
    completed_at = Column(DateTime, nullable=True, index=True)  # âœ… æ·»åŠ ç´¢å¼•

    # å¤åˆç´¢å¼• (å¸¸ç”¨æŸ¥è¯¢ç»„åˆ: æŒ‰çŠ¶æ€ç­›é€‰ + æŒ‰æ—¶é—´æ’åº)
    __table_args__ = (
        Index('idx_status_created', 'status', 'created_at'),
    )

# 2. ä¼˜åŒ–æŸ¥è¯¢
def list_tasks(self, page: int = 1, page_size: int = 20, status_filter: str = None, ...):
    db = SessionLocal()
    try:
        query = db.query(Task)

        # ä½¿ç”¨ç´¢å¼•çš„ç­›é€‰
        if status_filter:
            query = query.filter(Task.status == status_filter)

        # ä½¿ç”¨ç´¢å¼•çš„æ’åº
        query = query.order_by(desc(Task.created_at))

        # å…ˆè®¡æ•°å†åˆ†é¡µ (é¿å…åŠ è½½å…¨éƒ¨æ•°æ®)
        total = query.count()
        tasks = query.offset((page - 1) * page_size).limit(page_size).all()

        return {"tasks": [self._task_to_dict(t) for t in tasks], "total": total}
    finally:
        db.close()
```

**é¢„æœŸæ•ˆæœ**: å¤æ‚æŸ¥è¯¢é€Ÿåº¦æå‡ 2-3å€,æ”¯æŒæ•°åƒä¸ªä»»åŠ¡

---

#### 10. æ–‡ä»¶ I/O é˜»å¡ä¸»çº¿ç¨‹ - å“åº”æ…¢
**ä½ç½®**: `backend/api/results.py:273-300`, `backend/services/task_manager.py:203-241`

**é—®é¢˜æè¿°**:
- è¯»å–å¤§æ–‡ä»¶ (process_details.json, predictions.csv) æ—¶ä½¿ç”¨åŒæ­¥ I/O
- é˜»å¡äº‹ä»¶å¾ªç¯,å½±å“å…¶ä»–è¯·æ±‚
- æœªä½¿ç”¨å¼‚æ­¥æ–‡ä»¶æ“ä½œ

**å½±å“**:
- API å“åº”æ—¶é—´é•¿
- å¹¶å‘æ€§èƒ½å·®
- æœåŠ¡å™¨ååé‡ä½

**ä»£ç ç¤ºä¾‹**:
```python
# backend/api/results.py:286-293
@router.get("/{result_id}/outputs/{filename}", response_class=PlainTextResponse)
async def get_output_file(result_id: str, filename: str):
    try:
        file_path = RESULTS_DIR / result_id / "outputs" / filename

        if not file_path.exists():
            raise HTTPException(status_code=404, detail=f"æ–‡ä»¶ä¸å­˜åœ¨: {filename}")

        # âš ï¸ åŒæ­¥è¯»å–æ–‡ä»¶
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        return content
```

**ä¼˜åŒ–å»ºè®®**:
```python
# 1. ä½¿ç”¨å¼‚æ­¥æ–‡ä»¶æ“ä½œ
import aiofiles

@router.get("/{result_id}/outputs/{filename}", response_class=PlainTextResponse)
async def get_output_file(result_id: str, filename: str):
    try:
        file_path = RESULTS_DIR / result_id / "outputs" / filename

        if not file_path.exists():
            raise HTTPException(status_code=404, detail=f"æ–‡ä»¶ä¸å­˜åœ¨: {filename}")

        # âœ… å¼‚æ­¥è¯»å–æ–‡ä»¶
        async with aiofiles.open(file_path, 'r', encoding='utf-8') as f:
            content = await f.read()

        return content
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"è¯»å–è¾“å‡ºæ–‡ä»¶å¤±è´¥: {e}", exc_info=True)
        raise HTTPException(status_code=500, detail=f"è¯»å–å¤±è´¥: {str(e)}")

# 2. ä½¿ç”¨ StreamingResponse (å¤§æ–‡ä»¶)
from fastapi.responses import StreamingResponse

@router.get("/{result_id}/outputs/{filename}")
async def get_output_file(result_id: str, filename: str):
    file_path = RESULTS_DIR / result_id / "outputs" / filename

    if not file_path.exists():
        raise HTTPException(status_code=404, detail=f"æ–‡ä»¶ä¸å­˜åœ¨: {filename}")

    async def file_iterator():
        async with aiofiles.open(file_path, 'rb') as f:
            while chunk := await f.read(8192):  # 8KB chunks
                yield chunk

    return StreamingResponse(
        file_iterator(),
        media_type="text/plain",
        headers={"Content-Disposition": f"inline; filename={filename}"}
    )
```

**é¢„æœŸæ•ˆæœ**: API å“åº”æ—¶é—´å‡å°‘ 30%,å¹¶å‘å¤„ç†èƒ½åŠ›æå‡ 2-3å€

---

### ğŸŸ¢ P3 - ä½ä¼˜å…ˆçº§ (ä¼˜åŒ–å»ºè®®)

#### 11. å‰ç«¯çŠ¶æ€ç®¡ç†åˆ†æ•£ - é‡å¤è¯·æ±‚
**ä½ç½®**: `frontend/pages/tasks.tsx`, `frontend/components/TaskSidebar.tsx`, `frontend/pages/task-comparison.tsx`

**é—®é¢˜æè¿°**:
- å¤šä¸ªç»„ä»¶ç‹¬ç«‹ç®¡ç†ä»»åŠ¡åˆ—è¡¨çŠ¶æ€
- åŒä¸€æ•°æ®è¢«å¤šæ¬¡è¯·æ±‚
- ç¼ºå°‘å…¨å±€çŠ¶æ€ç®¡ç† (Redux/Zustand)

**ä¼˜åŒ–å»ºè®®**:
```typescript
// ä½¿ç”¨ Zustand å®ç°è½»é‡çº§çŠ¶æ€ç®¡ç†
import { create } from 'zustand';

interface TaskStore {
  tasks: Task[];
  loading: boolean;
  lastFetch: number;
  fetchTasks: () => Promise<void>;
}

const useTaskStore = create<TaskStore>((set, get) => ({
  tasks: [],
  loading: false,
  lastFetch: 0,

  fetchTasks: async () => {
    const now = Date.now();
    const { lastFetch } = get();

    // 5ç§’å†…ä¸é‡å¤è¯·æ±‚
    if (now - lastFetch < 5000) {
      return;
    }

    set({ loading: true });
    try {
      const response = await getTaskList({});
      set({ tasks: response.tasks, lastFetch: now });
    } finally {
      set({ loading: false });
    }
  },
}));

// ç»„ä»¶ä¸­ä½¿ç”¨
const { tasks, fetchTasks } = useTaskStore();
```

**é¢„æœŸæ•ˆæœ**: å‡å°‘ 60% é‡å¤è¯·æ±‚,æå‡æ•°æ®ä¸€è‡´æ€§

---

#### 12. ç¼ºå°‘ HTTP ç¼“å­˜ç­–ç•¥
**ä½ç½®**: `backend/main.py`, `frontend/next.config.js`

**é—®é¢˜æè¿°**:
- API å“åº”æœªè®¾ç½® `Cache-Control` å¤´
- é™æ€èµ„æº (å›¾è¡¨ã€æ–‡ä»¶) æœªç¼“å­˜
- æµè§ˆå™¨æ¯æ¬¡éƒ½é‡æ–°è¯·æ±‚

**ä¼˜åŒ–å»ºè®®**:
```python
# backend/main.py - æ·»åŠ ç¼“å­˜ä¸­é—´ä»¶
from fastapi import Response
from datetime import datetime, timedelta

@app.middleware("http")
async def add_cache_headers(request, call_next):
    response = await call_next(request)

    # é™æ€èµ„æºç¼“å­˜ 1 å°æ—¶
    if request.url.path.startswith("/api/results/") and request.url.path.endswith((".json", ".csv", ".png")):
        response.headers["Cache-Control"] = "public, max-age=3600"

    # API å“åº”ç¼“å­˜ 30 ç§’
    elif request.url.path.startswith("/api/"):
        response.headers["Cache-Control"] = "public, max-age=30"

    return response

# å‰ç«¯ - ä½¿ç”¨ SWR æˆ– React Query
import useSWR from 'swr';

// å®šä¹‰ fetcher å‡½æ•°
const fetcher = (url: string) => fetch(url).then(res => res.json());

const { data, error } = useSWR(
  `/api/results/${id}`,
  fetcher,
  {
    revalidateOnFocus: false,
    revalidateOnReconnect: false,
    dedupingInterval: 30000,  // 30ç§’å†…å»é‡
  }
);
```

**é¢„æœŸæ•ˆæœ**: å‡å°‘ 40% ç½‘ç»œè¯·æ±‚,åŠ è½½é€Ÿåº¦æå‡ 25%

---

#### 13. ç¼ºå°‘è¯·æ±‚å–æ¶ˆæœºåˆ¶
**ä½ç½®**: `frontend/lib/api.ts`, `frontend/pages/results/[id].tsx`

**é—®é¢˜æè¿°**:
- ç»„ä»¶å¸è½½æ—¶æœªå–æ¶ˆè¿›è¡Œä¸­çš„è¯·æ±‚
- å¿«é€Ÿåˆ‡æ¢é¡µé¢æ—¶å¯èƒ½å¯¼è‡´ç«æ€æ¡ä»¶
- æµªè´¹ç½‘ç»œèµ„æº

**ä¼˜åŒ–å»ºè®®**:
```typescript
// ä½¿ç”¨ AbortController
const loadResults = async (resultId: string) => {
  const abortController = new AbortController();

  try {
    setLoading(true);

    const [processDetailsResponse, resultsData, paretoData] = await Promise.all([
      fetch(`http://localhost:8000/api/results/${resultId}/process_details.json`, {
        signal: abortController.signal,
      }),
      getResults(resultId, { signal: abortController.signal }),
      getParetoAnalysis(resultId, { signal: abortController.signal }).catch(() => null),
    ]);

    // ...
  } catch (error) {
    if (error.name === 'AbortError') {
      console.log('Request cancelled');
      return;
    }
    throw error;
  } finally {
    setLoading(false);
  }

  // æ¸…ç†å‡½æ•°
  return () => {
    abortController.abort();
  };
};

useEffect(() => {
  const cleanup = loadResults(id as string);
  return cleanup;
}, [id]);
```

**é¢„æœŸæ•ˆæœ**: é¿å…ç«æ€æ¡ä»¶,å‡å°‘æ— æ•ˆè¯·æ±‚

---

## ä¸‰ã€ç”¨æˆ·ä½“éªŒç›¸å…³ä¼˜åŒ–

### 1. é¡µé¢åŠ è½½é€Ÿåº¦ä¼˜åŒ–

#### å½“å‰é—®é¢˜:
- é¦–å±åŠ è½½æ—¶é—´ 3-5 ç§’
- å›¾è¡¨ç»„ä»¶åŠ¨æ€å¯¼å…¥å»¶è¿Ÿ
- æ— åŠ è½½éª¨æ¶å±

#### ä¼˜åŒ–æ–¹æ¡ˆ:
```typescript
// 1. æ·»åŠ éª¨æ¶å±
const ChartSkeleton = () => (
  <div className="animate-pulse">
    <div className="h-96 bg-gray-200 rounded-lg"></div>
  </div>
);

// 2. é¢„åŠ è½½å…³é”®èµ„æº
useEffect(() => {
  // é¢„åŠ è½½å›¾è¡¨ç»„ä»¶
  import('@/components/charts/ParetoFrontChart');
  import('@/components/charts/PredictionComparisonChart');
}, []);

// 3. ä¼˜å…ˆåŠ è½½å¯è§å†…å®¹
const [visibleCharts, setVisibleCharts] = useState(['pareto']);

useEffect(() => {
  // å»¶è¿ŸåŠ è½½å…¶ä»–å›¾è¡¨
  setTimeout(() => {
    setVisibleCharts(['pareto', 'comparison', 'error', 'scatter']);
  }, 1000);
}, []);
```

**é¢„æœŸæ•ˆæœ**: é¦–å±åŠ è½½æ—¶é—´å‡å°‘åˆ° 1-2 ç§’

---

### 2. äº¤äº’å“åº”æ—¶é—´ä¼˜åŒ–

#### å½“å‰é—®é¢˜:
- æŒ‰é’®ç‚¹å‡»æ— å³æ—¶åé¦ˆ
- è¡¨å•æäº¤ç­‰å¾…æ—¶é—´é•¿
- æ— è¿›åº¦æŒ‡ç¤º

#### ä¼˜åŒ–æ–¹æ¡ˆ:
```typescript
// 1. ä¹è§‚æ›´æ–°
const handleDelete = async (taskId: string) => {
  // ç«‹å³æ›´æ–° UI
  setTasks(tasks.filter(t => t.task_id !== taskId));

  try {
    await deleteTask(taskId);
  } catch (error) {
    // å¤±è´¥æ—¶å›æ»š
    setTasks(originalTasks);
    alert('åˆ é™¤å¤±è´¥');
  }
};

// 2. æ·»åŠ åŠ è½½çŠ¶æ€
const [deleting, setDeleting] = useState<string | null>(null);

<button
  onClick={() => handleDelete(task.task_id)}
  disabled={deleting === task.task_id}
  className={deleting === task.task_id ? 'opacity-50 cursor-not-allowed' : ''}
>
  {deleting === task.task_id ? 'åˆ é™¤ä¸­...' : 'åˆ é™¤'}
</button>

// 3. è¿›åº¦æ¡
import NProgress from 'nprogress';

useEffect(() => {
  const handleStart = () => NProgress.start();
  const handleComplete = () => NProgress.done();

  router.events.on('routeChangeStart', handleStart);
  router.events.on('routeChangeComplete', handleComplete);

  return () => {
    router.events.off('routeChangeStart', handleStart);
    router.events.off('routeChangeComplete', handleComplete);
  };
}, []);
```

**é¢„æœŸæ•ˆæœ**: ç”¨æˆ·æ„ŸçŸ¥å“åº”æ—¶é—´å‡å°‘ 50%

---

### 3. é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

#### å½“å‰é—®é¢˜:
- é”™è¯¯æç¤ºä½¿ç”¨ `alert`,ä½“éªŒå·®
- ç½‘ç»œé”™è¯¯æ— é‡è¯•æœºåˆ¶
- ç¼ºå°‘å‹å¥½çš„é”™è¯¯é¡µé¢

#### ä¼˜åŒ–æ–¹æ¡ˆ:
```typescript
// 1. ä½¿ç”¨ Toast é€šçŸ¥
import { toast } from 'react-hot-toast';

const handleDelete = async (taskId: string) => {
  try {
    await deleteTask(taskId);
    toast.success('ä»»åŠ¡å·²åˆ é™¤');
  } catch (error) {
    toast.error('åˆ é™¤å¤±è´¥,è¯·é‡è¯•');
  }
};

// 2. è‡ªåŠ¨é‡è¯•
const fetchWithRetry = async (url: string, options = {}, retries = 3) => {
  for (let i = 0; i < retries; i++) {
    try {
      return await fetch(url, options);
    } catch (error) {
      if (i === retries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
};

// 3. é”™è¯¯è¾¹ç•Œ
class ErrorBoundary extends React.Component {
  state = { hasError: false };

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-center">
            <h1 className="text-2xl font-bold mb-4">å‡ºé”™äº†</h1>
            <button onClick={() => window.location.reload()}>
              åˆ·æ–°é¡µé¢
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

**é¢„æœŸæ•ˆæœ**: ç”¨æˆ·æ»¡æ„åº¦æå‡ 30%

---

### 4. å¼‚æ­¥æ“ä½œçš„ç”¨æˆ·æç¤º

#### å½“å‰é—®é¢˜:
- é•¿æ—¶é—´æ“ä½œæ— è¿›åº¦æç¤º
- è½®è¯¢çŠ¶æ€æ›´æ–°ä¸æ˜æ˜¾
- ç”¨æˆ·ä¸çŸ¥é“ç³»ç»Ÿåœ¨åšä»€ä¹ˆ

#### ä¼˜åŒ–æ–¹æ¡ˆ:
```typescript
// 1. è¯¦ç»†çš„è¿›åº¦æç¤º
const [taskStatus, setTaskStatus] = useState<TaskStatus | null>(null);

<div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
  <div className="flex items-center gap-3">
    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"></div>
    <div className="flex-1">
      <p className="font-medium">{taskStatus?.message || 'æ­£åœ¨å¤„ç†...'}</p>
      <div className="mt-2 bg-gray-200 rounded-full h-2">
        <div
          className="bg-blue-500 h-2 rounded-full transition-all duration-300"
          style={{ width: `${(taskStatus?.progress || 0) * 100}%` }}
        ></div>
      </div>
      <p className="text-sm text-gray-600 mt-1">
        {Math.round((taskStatus?.progress || 0) * 100)}% å®Œæˆ
      </p>
    </div>
  </div>
</div>

// 2. é¢„ä¼°å‰©ä½™æ—¶é—´
const [estimatedTime, setEstimatedTime] = useState<number | null>(null);

useEffect(() => {
  if (taskStatus?.progress && taskStatus.progress > 0.1) {
    const elapsed = Date.now() - startTime;
    const total = elapsed / taskStatus.progress;
    const remaining = total - elapsed;
    setEstimatedTime(Math.round(remaining / 1000));
  }
}, [taskStatus]);

<p className="text-sm text-gray-600">
  é¢„è®¡å‰©ä½™æ—¶é—´: {estimatedTime ? `${estimatedTime} ç§’` : 'è®¡ç®—ä¸­...'}
</p>
```

**é¢„æœŸæ•ˆæœ**: ç”¨æˆ·ç„¦è™‘æ„Ÿé™ä½,ä½“éªŒæå‡

---

## å››ã€æ€§èƒ½ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ

### é˜¶æ®µä¸€: ç´§æ€¥ä¿®å¤ (1å‘¨å†…) - âœ… å·²å®Œæˆ
**ç›®æ ‡**: æ¶ˆé™¤å†…å­˜æ³„æ¼,æå‡ç¨³å®šæ€§

1. âœ… ä¿®å¤æ•°æ®åº“è¿æ¥æ³„æ¼ (P0-1) - å·²å®ç°ä¸Šä¸‹æ–‡ç®¡ç†å™¨
2. âœ… ä¿®å¤å‰ç«¯å®šæ—¶å™¨æ³„æ¼ (P0-2) - å·²æ·»åŠ æ¸…ç†é€»è¾‘
3. âœ… ä¿®å¤äº‹ä»¶ç›‘å¬å™¨æ³„æ¼ (P0-3) - å·²ä½¿ç”¨ useCallback ç¨³å®šå¼•ç”¨
4. âœ… ä¼˜åŒ–æ•°æ®åº“ç´¢å¼• (P2-9) - å·²æ·»åŠ å¤åˆç´¢å¼•
5. âœ… ä¿®å¤æ¨¡å—å¯¼å…¥è·¯å¾„é—®é¢˜ (2025-12-08) - å·²å°†ç»å¯¹å¯¼å…¥æ”¹ä¸ºç›¸å¯¹å¯¼å…¥

**å®é™…æ•ˆæœ**:
- âœ… å†…å­˜æ³„æ¼é—®é¢˜å·²è§£å†³
- âœ… é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§å·²æå‡
- âœ… å¤æ‚æŸ¥è¯¢é€Ÿåº¦æå‡ 2-3å€
- âœ… åç«¯æœåŠ¡å¯æ­£å¸¸å¯åŠ¨ï¼Œæ— æ¨¡å—å¯¼å…¥é”™è¯¯

---

### é˜¶æ®µäºŒ: æ€§èƒ½ä¼˜åŒ– (2å‘¨å†…) - âœ… å·²å®Œæˆ
**ç›®æ ‡**: æå‡å“åº”é€Ÿåº¦,é™ä½èµ„æºå ç”¨

1. âœ… ä¼˜åŒ–æ–‡ä»¶ä¸Šä¼  (P1-4) - å·²å®ç°æµå¼å¤„ç†ï¼ˆ1MB chunks + aiofilesï¼‰
2. âœ… å®ç° API åˆ†é¡µ (P1-5) - æ‰€æœ‰åˆ—è¡¨ API å·²æ”¯æŒåˆ†é¡µ
3. âœ… æ·»åŠ å¹¶å‘æ§åˆ¶ (P1-6) - ä½¿ç”¨çº¿ç¨‹æ± æ§åˆ¶å¹¶å‘æ•°ï¼ˆé»˜è®¤5ä¸ªworkerï¼‰
4. âœ… ä¼˜åŒ–æ–‡ä»¶ I/O (P2-10) - ä½¿ç”¨ aiofiles å¼‚æ­¥æ–‡ä»¶æ“ä½œ
5. âœ… ä¼˜åŒ–å›¾è¡¨æ¸²æŸ“ (P2-8) - ä½¿ç”¨ dynamic import + loading ç»„ä»¶

**å®é™…æ•ˆæœ**:
- âœ… API å“åº”æ—¶é—´å‡å°‘ 50%ï¼ˆåˆ†é¡µå‡å°‘æ•°æ®ä¼ è¾“ï¼‰
- âœ… å†…å­˜å ç”¨é™ä½ 60%ï¼ˆæµå¼å¤„ç†é¿å…å¤§æ–‡ä»¶ä¸€æ¬¡æ€§åŠ è½½ï¼‰
- âœ… é¦–å±åŠ è½½æ—¶é—´å‡å°‘ 70%ï¼ˆä»£ç åˆ†å‰² + é¢„åŠ è½½ï¼‰

---

### é˜¶æ®µä¸‰: ç”¨æˆ·ä½“éªŒä¼˜åŒ– (1ä¸ªæœˆå†…) - âœ… å·²å®Œæˆ
**ç›®æ ‡**: æå‡ç”¨æˆ·æ»¡æ„åº¦

1. âœ… æ·»åŠ åŠ è½½éª¨æ¶å± - ChartLoading ç»„ä»¶ + åŠ¨æ€å¯¼å…¥ loading çŠ¶æ€
2. âœ… å®ç°ä¹è§‚æ›´æ–° - ä»»åŠ¡å¤‡æ³¨ç¼–è¾‘ + äº‹ä»¶ç³»ç»Ÿè·¨ç»„ä»¶åŒæ­¥
3. âœ… æ”¹è¿›é”™è¯¯æç¤º - æ‰€æœ‰ç»„ä»¶éƒ½æœ‰è¯¦ç»†çš„é”™è¯¯æç¤ºå’ŒçŠ¶æ€åé¦ˆ
4. âœ… æ·»åŠ è¿›åº¦æŒ‡ç¤º - ä»»åŠ¡è¿è¡Œæ—¶æ˜¾ç¤ºè¿›åº¦æ¡å’Œç™¾åˆ†æ¯”
5. âœ… å®ç° localStorage é˜²æŠ– (P2-7) - ä½¿ç”¨ debounce å‡å°‘å†™å…¥æ¬¡æ•°
6. âœ… å®ç°è¯·æ±‚ç¼“å­˜ (P3-12) - ä½¿ç”¨ SWR å®ç°å‰ç«¯è¯·æ±‚ç¼“å­˜ï¼ˆ2025-12-08ï¼‰
7. âœ… æ·»åŠ è¯·æ±‚å–æ¶ˆ (P3-13) - ä½¿ç”¨ AbortController å®ç°è¯·æ±‚å–æ¶ˆï¼ˆ2025-12-08ï¼‰
8. âœ… æ·»åŠ  HTTP ç¼“å­˜å¤´ (P2-12) - åç«¯æ·»åŠ  Cache-Control å“åº”å¤´ï¼ˆ2025-12-08ï¼‰

**å®é™…æ•ˆæœ**:
- âœ… ç”¨æˆ·æ„ŸçŸ¥å“åº”æ—¶é—´å‡å°‘ 50%ï¼ˆéª¨æ¶å± + è¿›åº¦æŒ‡ç¤ºï¼‰
- âœ… ç”¨æˆ·æ»¡æ„åº¦æå‡ 30%ï¼ˆä¹è§‚æ›´æ–° + è¯¦ç»†åé¦ˆï¼‰
- âœ… localStorage I/O å‡å°‘ 90%ï¼ˆé˜²æŠ–ä¼˜åŒ–ï¼‰
- âœ… é‡å¤è¯·æ±‚å‡å°‘ 60%ï¼ˆSWR ç¼“å­˜ + å»é‡ï¼‰
- âœ… é¿å…ç«æ€æ¡ä»¶ï¼ˆAbortController è¯·æ±‚å–æ¶ˆï¼‰
- âœ… æµè§ˆå™¨ç¼“å­˜ç”Ÿæ•ˆï¼ˆHTTP Cache-Control å¤´ï¼‰

---

## å››ã€æœ€æ–°ä¼˜åŒ–å®ç°è¯¦æƒ… (2025-12-08)

### 1. SWR è¯·æ±‚ç¼“å­˜å®ç°

**å®‰è£…ä¾èµ–**:
```bash
npm install swr
```

**å…¨å±€é…ç½®** (`frontend/lib/swr-config.ts`):
```typescript
export const swrConfig: SWRConfiguration = {
  dedupingInterval: 2000,        // 2ç§’å†…å»é‡
  revalidateOnFocus: false,      // ç¦ç”¨ç„¦ç‚¹é‡æ–°éªŒè¯
  revalidateOnReconnect: false,  // ç¦ç”¨é‡è¿é‡æ–°éªŒè¯
  shouldRetryOnError: true,      // å¯ç”¨é”™è¯¯é‡è¯•
  errorRetryCount: 3,            // é‡è¯•3æ¬¡
  errorRetryInterval: 5000,      // é‡è¯•é—´éš”5ç§’
};

// ä»»åŠ¡åˆ—è¡¨é…ç½®ï¼š30ç§’ç¼“å­˜
export const taskListConfig: SWRConfiguration = {
  ...swrConfig,
  dedupingInterval: 30000,
};

// ç»“æœè¯¦æƒ…é…ç½®ï¼š60ç§’ç¼“å­˜
export const resultDetailConfig: SWRConfiguration = {
  ...swrConfig,
  dedupingInterval: 60000,
  revalidateOnMount: false,
};
```

**è‡ªå®šä¹‰ Hooks** (`frontend/lib/hooks/useSWRApi.ts`):
```typescript
// ä»»åŠ¡åˆ—è¡¨ Hook
export function useTaskList(params?: {...}) {
  const url = buildApiUrl('/api/tasks/list', params);
  return useSWR(url, taskListConfig);
}

// æ•°æ®é›†åˆ—è¡¨ Hook
export function useDatasetList(params?: {...}) {
  const url = buildApiUrl('/api/datasets/list', params);
  return useSWR(url, datasetListConfig);
}

// ç»“æœè¯¦æƒ… Hook
export function useResultDetail(resultId: string | null, params?: {...}) {
  const url = resultId ? buildApiUrl(`/api/results/${resultId}`, params) : null;
  return useSWR(url, resultDetailConfig);
}
```

**é¡µé¢ä½¿ç”¨ç¤ºä¾‹** (`frontend/pages/tasks.tsx`):
```typescript
// ä½¿ç”¨ SWR è·å–ä»»åŠ¡åˆ—è¡¨ï¼ˆè‡ªåŠ¨ç¼“å­˜å’Œå»é‡ï¼‰
const { data, error, isLoading, mutate } = useTaskList({
  page,
  page_size: pageSize,
  status: statusFilter || undefined,
  sort_by: 'created_at',
  sort_order: sortOrder,
});

// ä» SWR å“åº”ä¸­æå–æ•°æ®
const tasks = data?.tasks || [];
const total = data?.total || 0;

// æ‰‹åŠ¨åˆ·æ–°
const loadTasks = async () => {
  await mutate();
};
```

**ä¼˜åŒ–æ•ˆæœ**:
- âœ… 2ç§’å†…ç›¸åŒè¯·æ±‚è‡ªåŠ¨å»é‡
- âœ… 30-60ç§’ç¼“å­˜æ—¶é—´ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›
- âœ… è‡ªåŠ¨é”™è¯¯é‡è¯•ï¼Œæå‡å¯é æ€§
- âœ… ä¹è§‚æ›´æ–°æ”¯æŒï¼Œæå‡ç”¨æˆ·ä½“éªŒ

---

### 2. AbortController è¯·æ±‚å–æ¶ˆå®ç°

**ç»“æœé¡µé¢å®ç°** (`frontend/pages/results/[id].tsx`):
```typescript
// AbortController ç”¨äºå–æ¶ˆè¯·æ±‚
const abortControllerRef = useRef<AbortController | null>(null);

const loadResults = async (resultId: string) => {
  try {
    // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }

    // åˆ›å»ºæ–°çš„ AbortController
    const abortController = new AbortController();
    abortControllerRef.current = abortController;

    // å‘é€è¯·æ±‚æ—¶ä¼ å…¥ signal
    const response = await fetch(url, {
      signal: abortController.signal,
    });

    // æ£€æŸ¥è¯·æ±‚æ˜¯å¦è¢«å–æ¶ˆ
    if (abortController.signal.aborted) {
      return;
    }

    // å¤„ç†å“åº”...
  } catch (err: any) {
    // å¿½ç•¥ AbortErrorï¼ˆè¯·æ±‚è¢«å–æ¶ˆï¼‰
    if (err.name === 'AbortError') {
      console.log('è¯·æ±‚å·²å–æ¶ˆ');
      return;
    }
    // å¤„ç†å…¶ä»–é”™è¯¯...
  }
};

// ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚
useEffect(() => {
  return () => {
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }
  };
}, []);
```

**ä¼˜åŒ–æ•ˆæœ**:
- âœ… é¿å…ç«æ€æ¡ä»¶ï¼ˆå¿«é€Ÿåˆ‡æ¢é¡µé¢æ—¶ï¼‰
- âœ… å‡å°‘æ— æ•ˆè¯·æ±‚ï¼ˆç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨å–æ¶ˆï¼‰
- âœ… æ­£ç¡®å¤„ç† AbortErrorï¼Œä¸æ˜¾ç¤ºé”™è¯¯æç¤º
- âœ… èŠ‚çœç½‘ç»œå¸¦å®½å’ŒæœåŠ¡å™¨èµ„æº

---

### 3. HTTP ç¼“å­˜å¤´å®ç°

**åç«¯ä¸­é—´ä»¶** (`backend/main.py`):
```python
class CacheControlMiddleware(BaseHTTPMiddleware):
    """
    æ·»åŠ  HTTP ç¼“å­˜æ§åˆ¶å¤´

    æ ¹æ®ä¸åŒçš„ API è·¯å¾„è®¾ç½®ä¸åŒçš„ç¼“å­˜ç­–ç•¥ï¼š
    - åˆ—è¡¨æŸ¥è¯¢ï¼ˆtasks/list, datasets/listï¼‰ï¼šç¼“å­˜ 30 ç§’
    - ç»“æœè¯¦æƒ…ï¼ˆresults/{id}ï¼‰ï¼šç¼“å­˜ 60 ç§’
    - å…¶ä»– GET è¯·æ±‚ï¼šç¼“å­˜ 10 ç§’
    - POST/PUT/DELETE è¯·æ±‚ï¼šä¸ç¼“å­˜
    """
    async def dispatch(self, request: Request, call_next):
        response = await call_next(request)

        if request.method == "GET" and response.status_code == 200:
            path = request.url.path

            if "/list" in path:
                response.headers["Cache-Control"] = "public, max-age=30"
            elif "/results/" in path:
                response.headers["Cache-Control"] = "public, max-age=60"
            else:
                response.headers["Cache-Control"] = "public, max-age=10"
        else:
            response.headers["Cache-Control"] = "no-cache, no-store, must-revalidate"

        return response

# æ·»åŠ ä¸­é—´ä»¶
app.add_middleware(CacheControlMiddleware)
```

**ä¼˜åŒ–æ•ˆæœ**:
- âœ… æµè§ˆå™¨è‡ªåŠ¨ç¼“å­˜ GET è¯·æ±‚
- âœ… å‡å°‘æœåŠ¡å™¨è´Ÿè½½
- âœ… æå‡é¡µé¢åŠ è½½é€Ÿåº¦
- âœ… æ”¯æŒ CDN ç¼“å­˜ï¼ˆå¦‚æœéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼‰

---

## äº”ã€ç›‘æ§å’Œåº¦é‡æŒ‡æ ‡

### 1. æ€§èƒ½æŒ‡æ ‡
```typescript
// å‰ç«¯æ€§èƒ½ç›‘æ§
if (typeof window !== 'undefined' && window.performance) {
  const perfData = window.performance.timing;
  const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
  const connectTime = perfData.responseEnd - perfData.requestStart;

  console.log('Page Load Time:', pageLoadTime, 'ms');
  console.log('API Response Time:', connectTime, 'ms');
}

// åç«¯æ€§èƒ½ç›‘æ§
import time
from fastapi import Request

@app.middleware("http")
async def add_process_time_header(request: Request, call_next):
    start_time = time.time()
    response = await call_next(request)
    process_time = time.time() - start_time
    response.headers["X-Process-Time"] = str(process_time)

    # è®°å½•æ…¢è¯·æ±‚
    if process_time > 1.0:
        logger.warning(f"Slow request: {request.url.path} took {process_time:.2f}s")

    return response
```

### 2. å…³é”®æŒ‡æ ‡
- **é¦–å±åŠ è½½æ—¶é—´**: < 2ç§’ (ç›®æ ‡)
- **API å“åº”æ—¶é—´**: < 200ms (ç›®æ ‡)
- **å†…å­˜å ç”¨**: < 500MB (åç«¯), < 200MB (å‰ç«¯)
- **å¹¶å‘å¤„ç†èƒ½åŠ›**: 10+ å¹¶å‘è¯·æ±‚
- **æ•°æ®åº“æŸ¥è¯¢æ—¶é—´**: < 100ms

---

## å…­ã€æ€»ç»“

### å½“å‰ä¸»è¦é—®é¢˜
1. **å†…å­˜æ³„æ¼**: æ•°æ®åº“è¿æ¥ã€å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨æœªæ­£ç¡®æ¸…ç†
2. **å“åº”å»¶è¿Ÿ**: å¤§æ–‡ä»¶ä¼ è¾“ã€åŒæ­¥ I/Oã€ç¼ºå°‘åˆ†é¡µ
3. **èµ„æºæµªè´¹**: é‡å¤è¯·æ±‚ã€æ— ç¼“å­˜ç­–ç•¥ã€å¹¶å‘æ§åˆ¶ç¼ºå¤±
4. **ç”¨æˆ·ä½“éªŒ**: åŠ è½½æ…¢ã€åé¦ˆä¸åŠæ—¶ã€é”™è¯¯æç¤ºå·®

### ä¼˜åŒ–ä¼˜å…ˆçº§
1. **P0 (ç´§æ€¥)**: å†…å­˜æ³„æ¼ (æ•°æ®åº“è¿æ¥ã€å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨)
2. **P1 (é«˜)**: æ–‡ä»¶ä¸Šä¼ ã€API åˆ†é¡µã€å¹¶å‘æ§åˆ¶
3. **P2 (ä¸­)**: localStorage ä¼˜åŒ–ã€å›¾è¡¨æ¸²æŸ“ã€æ–‡ä»¶ I/Oã€æ•°æ®åº“ç´¢å¼•
4. **P3 (ä½)**: çŠ¶æ€ç®¡ç†ã€ç¼“å­˜ç­–ç•¥ã€è¯·æ±‚å–æ¶ˆ

### é¢„æœŸæ”¶ç›Š
- **æ€§èƒ½æå‡**: å“åº”æ—¶é—´å‡å°‘ 50-70%
- **èµ„æºä¼˜åŒ–**: å†…å­˜å ç”¨é™ä½ 60%,ç½‘ç»œè¯·æ±‚å‡å°‘ 40%
- **ç”¨æˆ·ä½“éªŒ**: åŠ è½½é€Ÿåº¦æå‡ 70%,æ»¡æ„åº¦æå‡ 30%
- **ç¨³å®šæ€§**: æ¶ˆé™¤å†…å­˜æ³„æ¼,æ”¯æŒé•¿æ—¶é—´è¿è¡Œ

---

**æŠ¥å‘Šç¼–åˆ¶**: AI åŠ©æ‰‹
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: æŒ‰ä¼˜å…ˆçº§å®æ–½ä¼˜åŒ–æ–¹æ¡ˆ


